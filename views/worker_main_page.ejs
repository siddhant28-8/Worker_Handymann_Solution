<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <title>Worker Dashboard Preview</title>
    <style>
        :root {
            --primary-purple: #9100FF;
            --dark-background: #1c1c1c;
            --light-text: #f8f9fa;
            --sidebar-bg: #2d2d2d;
            --sidebar-active-bg: #eae6f9;
        }
      body{
      background: linear-gradient(135deg, #f6f4f8, #9787cd);
      }
     
	 /* Top navbar */
	 /* Styling for the Post-Login Dropdown Menu */
   /* Top navbar */
    .navbar {
      background-color: #000 !important;
    }
    .navbar .nav-link{
     color: #9100FF !important;
    }
    .navbar .nav-link:hover, .navbar .nav-item.active .nav-link{
      color: #9100FF !important;
    }
    .navbar-toggler-icon {
      filter: invert(1);
    }

    .navbar-brand img {
       height: 40px; /* Adjust logo size */
       margin-right: 5px;
    }
    
    /* Styling for the Post-Login Dropdown Menu Container */
    .dropdown-menu {
        border-radius: 8px; /* Rounded corners for modern look */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); /* Soft shadow */
        padding: 0; /* Remove default padding for full-height items */
        background-color:var(--primary-purple) ;
    }
    
    /* Style for the Header (User Role and Name) */
    .dropdown-header {
        color: #333;
        font-weight: 600;
        padding: 0.75rem 1rem 0.5rem;
        white-space: nowrap; /* Prevents long names from wrapping */
    }
    
    /* Style for individual Dropdown Items (links) */
    .dropdown-item {
        padding: 0.75rem 1rem;
        transition: background-color 0.3s;
    }
    
    /* Hover effect for Dropdown Items */
    .dropdown-item:hover {
        background-color: var(--primary-purple); /* Background hover matching the theme */
        color: white !important; /* Text color change on hover to white */
    }
    
    /* Style for the Logout Button icon spacing */
    .dropdown-logout-btn i {
        margin-right: 8px;
    }
    
    /* Ensure the profile icon itself maintains the purple color in the navbar */
    /* This is important to ensure the icon is always purple even if other nav links are white */
    .nav-item.dropdown .nav-link i {
        color: var(--primary-purple) !important; 
    }

    .navbar-profile-img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary-purple);
      background-color: #fff;
      box-shadow: 0 0 6px rgba(145, 0, 255, 0.3);
      transition: transform 0.2s ease;
    }
    
    .navbar-profile-img:hover {
      transform: scale(1.05);
    }

    .btn-login {
            background-color: var(--primary-purple);
            color:white;
            padding: 0.375rem 1rem;
            border-radius: 0.25rem;
            text-decoration: none !important;
            font-weight: 500;
            margin-left: 15px;
    }
    
    #btnn{
            font-size: 40px;
            background-color:transparent; 
            width: 40px;
            border: none;
            
     }

        /* --- Dashboard Specific Styles --- */
        .dashboard-container {
            padding: 30px 15px;
            max-width: 1300px;
            margin: 0 auto;
        }

        /* 1. Sidebar/Navigation Panel */
        .nav {
            background-color:#1C1C1C1A;
            border-radius: 20px;
            left: 0;
            top: 0;
            color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            margin-top:20px;
          }  
          .nav ul {
            list-style: none;
            padding:10px 0;
            margin:0;
          }
          
          .nav li {
            padding: 15px;
            padding-left:20px;
          }
          
          .nav li a {
            color: #0c0c0c;
            text-decoration: none;
          }
          
          .nav li a:hover {
            color:#b118f8;
          }
          .img{
            padding-right: 20px;
          }
          .nav-val{
            padding-top: 40px;
          }

        /* 2. Profile Card Panel */
        .profile-panel {
            background-color: #E7E7E7;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 8px rgba(21, 21, 21, 0.6);
            margin-bottom: 20px;
            margin-top:20px;
        }

        .profile-img {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid var(--primary-purple);
            box-shadow: 0 0 10px rgba(145, 0, 255, 0.4);
            margin-bottom: 15px;
        }
        .profile-info{
           border-left: 1px solid #b1b0b0;
           height: 100%;
           margin-left: 5px;
        }
        .profile-info p {
            margin-bottom: 8px;
            font-size: 1rem;
        }
        .profile-info b {
            font-weight: 700;
            color: #333;
        }
        .profile-info span {
            font-weight: 500;
            color: #555;
            display: inline-block;
            min-width: 120px;
        }
      

        /* 3. Status Switch Card */
        .status-card {
         display: flex;
         flex-direction: column;      /* stack items vertically */
         justify-content: center;     /* center vertically inside card */
         align-items: center;
         text-align: center;          /* center text lines */
         background-color: transparent;
         border-left: 1px solid #636262;
         border-radius: 0 10px 10px 0;
         margin-left: 10px;
         padding-left: 10px;
         height: 100%;
        }

        .status-card h3 {
            color: var(--primary-purple);
            font-weight: 700;
            margin-bottom: 15px;
        }
        .status-card p {
            color: #666;
            margin-bottom: 25px;
            font-size: 0.9rem;
        }

        /* Custom Switch Styling to match the image */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: var(--primary-purple);
            -webkit-transition: .4s;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: #ccc; 
        }
        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }
        .slider.round {
            border-radius: 34px;
        }
        .slider.round:before {
            border-radius: 50%;
        }

       /* --- Footer Styling --- */
        .footer {
            background-color: var(--dark-background);
            color: white;
            padding: 40px 10px;
        }
        .footer-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: auto;
        }
        .footer-left {
            flex: 1;
            min-width: 200px;
            margin: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #706f6f;
        }
        .footer-left img {
            height: auto;
            width: auto;
            margin-bottom: 5px;
        }

        .footer-center{ 
            flex: 1;
            min-width: 200px;
            margin: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #706f6f;
        }
        .footer-center ul { 
            list-style: none; 
            padding: 0; 
            line-height: 2.2; 
        }
        .footer-center ul li a { 
            text-decoration: none; 
            color: white; 
            font-size: 14px; 
            transition: color 0.3s; 
        }
        .footer-center ul li a:hover { 
            color: var(--primary-purple); 
        }

        .footer-right { 
            flex: 1;
            min-width: 200px;
            margin: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px; 
        }
        .footer-right .social { 
            display: flex; 
            align-items: center; 
            font-size: 14px; 
        }
        .footer-right .social span { 
            margin-right: 10px; 
            color: #ccc; 
            min-width: 70px; 
            text-align: right;
        }
        .footer-right .social i { 
            font-size: 16px; 
            color: var(--primary-purple); 
            background: white; 
            border-radius: 4px; 
            padding: 5px; 
            transition: transform 0.3s; 
            margin-left: 10px; 
        }
        .footer-right .social i:hover { 
            transform: scale(1.1); 
        }
        .tagline { 
            font-size: 13px; 
            color: #ccc; 
            margin-top: 8px; 
        }
        @media (max-width: 992px) {
            .footer-left, .footer-center, .footer-right { border-right: none; margin-bottom: 20px; }
        }
        
        @media (min-width: 768px) {
            .sidebar-toggle-btn {
                display: none;
            }
        }
        @media (max-width: 767px) {
            .profile-divider {
                border-left: none;
                border-top: 1px solid #ddd;
                width: 100%;
                height: 1px;
                margin: 20px 0;
            }
        }

    </style>
</head>
<body>
   <!--header-->
<div class="container-fluid px-0">
    <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="/">
            <img src="logo.png" alt="HomeWork Logo">
        </a>
        
        <button class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto align-items-center">
                <li class="nav-item active px-3">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item px-3">
                    <a class="nav-link" href="/Pricing">Pricing</a>
                </li>
                <li class="nav-item px-3">
                    <a class="nav-link" href="/About">About</a>
                </li>
                <li class="nav-item px-3">
                    <a class="nav-link" href="/Contact">Contact</a>
                </li>
                <li class="nav-item px-3">
                    <a class="nav-link" href="/Faq">FAQs</a>
                </li>
                

                <% if (worker) { %>
                <li class="nav-item dropdown px-3">
                    <a class="nav-link" href="#" id="profileDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: 24px; padding: 0.375rem 0.5rem;">
                        <% if (worker.picture && worker.picture.trim() !== '') { %>
                            <img src="<%= worker.picture %>" 
                                 alt="Profile" 
                                 class="navbar-profile-img">
                        <% } else { %>
                            <i class="fas fa-user-circle" style="color: var(--primary-purple);"></i>
                        <% } %>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="profileDropdown">
                        <h6 class="dropdown-header" id="userRoleName">UserName: <%= worker.username %></h6> 
                        <div class="dropdown-divider"></div>

                        <a class="dropdown-item dropdown-logout-btn" href="/logout">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </li>
                <% } else { %>
                <li class="nav-item px-3">
                    <a class="btn-login" href="signin.html" >Login</a>
                </li>
                <% } %>
                </ul>
        </div>
    </nav>
</div>

<div style="display: flex; justify-content:start;">
          <button id="btnn">&lt;</button>
</div>

    <div class="dashboard-container">
        <div class="row">
            <div class="col-md-3 col-lg-2 sidebar-col" id="first">
                <div class="nav" style="max-width: 170px;" > 
                  <ul>
                  <li> <a href="#"><img src="pencil.png" alt="" width="19px" height="19px">   <span><a id="edit_profile" href="/profile/edit_profile/<%=worker.username%>"><b>Edit Profile</b></a></span></a>   </li>
                  <li>  <a href="#"><img src="time.png" alt="" width="20px" height="20px" >       <span><a id="history" href="/worker_history"><b>History</b></a></span></a>     </li>
                  <li>  <a href="#"> <img src="notification.png" alt="" width="20px" height="20px"> <span><a href="/Worker_notification"><b>Notification</b></span></a>  </li>
                  <li>   <a href="#"> <img src="order-delivery.png" alt="" width="20px" height="20px"> <span><a href="/Worker_order"><b>Order </b></a></span></a>  </li>
                  <li>   <a href="#"><img src="quit.png" alt="" width="20px" height="20px">  <span><a href="homepage.html"><b>Logout</b></a></span></a>  </li>
                  </ul>
                </div>
            </div>

            <div class="col-md-9 col-lg-10" id="main-content">
                <div class="row">
                    <div class="col-lg-8 mb-4">
                        <div class="profile-panel d-flex flex-wrap">
                            <div class="col-12 col-sm-4 text-center p-0">
                                <img class="profile-img" src="<%= worker.picture %>" alt="Profile" >
                                <button class="btn btn-dark" style="background-color: var(--dark-background); border-color: var(--dark-background);">Edit Profile</button>
                            </div>
                            
                            <div class="d-none d-sm-block profile-divider" id ="profile-divider"></div>

                            <div class="col-12 col-sm-7 profile-info pl-sm-4 mt-4 mt-sm-0 profile-details-col">
                               <p class="card-text">Username: <b><%= worker.username %></b></p> 
                               <p class="card-text">Email: <b><%= worker.email %></b></p>
                               <p class="card-text">Contact: <b><%= worker.contact %></b></p>
                               <p class="card-text">Experience: <b><%= worker.experience %> Year</b></p>
                               <p class="card-text">Member Since: <b>17-01-25</b></p>
                               <p class="card-text">From: <b><%= worker.location %></b></p>
                               <p class="card-text">Description: <b><%= worker.about %></b></p>
                            </div>
                        </div>
                    </div>

                    <div class="vertical-divider d-none d-md-block"></div>

                    <div class="col-lg-4 mb-4">
                        <div class="status-card h-100">
                            <h3 id="heading">
                                <% if (worker.isActive) { %>
                                    Out of service for a while?
                                <% } else { %>
                                    Let’s get back to business!
                                <% } %>
                            </h3>
                            <p id="para">
                                <% if (worker.isActive) { %>
                                    Disabling your account will save you from unwanted work requests. You can always activate your account again.
                                <% } else { %>
                                    Activate your account again to speed up your profits. You can always disable your account.
                                <% } %>
                            </p>
                            <div class="form-check form-switch text-center">
                                <label class="switch">
                                    <input type="checkbox" id="statusSwitch" <%= !worker.isActive ? 'checked' : '' %>>
                                    <span class="slider round"></span>
                                </label>
                            </div> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

          <footer class="footer">
        <div class="footer-container">
            <div class="footer-left">
                <img src="logo.png" alt="HomeWork Logo">
                <p class="tagline">Book your trusted handyman in just a few clicks.</p>
            </div>

            <div class="footer-center">
                <ul>
                    <li><a href="/About">About</a></li>
                    <li><a href="/Signin">Sign In</a></li>
                    <li><a href="/Faq">FAQs</a></li>
                    <li><a href="/Pricing">Pricing</a></li>
                    <li><a href="/Contact">Contact</a></li>
                </ul>
            </div>

            <div class="footer-right">
                <div class="social">
                    <span>@homvices</span><a href="#"><i class="fab fa-linkedin-in"></i></a>
                </div>
                <div class="social">
                    <span>@homvices</span><a href="#"><i class="fab fa-facebook-f"></i></a>
                </div>
                <div class="social">
                    <span>@homvices</span><a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
</footer>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script> 
 <script>
    // Simple client-side interaction for the preview
    const statusSwitch = document.getElementById('statusSwitch');
    const heading = document.getElementById('heading');
    const parag = document.getElementById('para');

    // Get the worker's email dynamically from the EJS variable
    // We assume 'worker' object is available in this scope, as shown in the EJS markup
    const workerEmail = "<%= worker.email %>"; 

    statusSwitch.addEventListener('change', async () => {
        const newStatus = statusSwitch.checked;
        
        // Data payload must match the backend route parameters (Email and status)
        const dataToSend = {
            Email: workerEmail,
            status: newStatus 
        };

        // 1. Optimistically update the UI text
        if (!newStatus) {
            heading.innerText = 'Out of service for a while?';
            parag.innerText = 'Disabling your account will save you from unwanted work requests. You can always activate your account again.';
        } else {
            heading.innerText = 'Let’s get back to business!';
            parag.innerText = 'Activate your account again to speed up your profits. You can always disable your account.';
        }

        // 2. Send the update to the server using the correct endpoint and payload
        try {
            const response = await fetch('/update-status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dataToSend), 
            });

            if (!response.ok) {
                // If the server update failed, revert the UI and notify the user
                statusSwitch.checked = !newStatus; // Revert the switch
                alert(`Failed to update status on server. Please try again.`);
                
                // Revert text to match the reverted switch state
                if (!newStatus) {
                    heading.innerText = 'Out of service for a while?';
                    parag.innerText = 'Disabling your account will save you from unwanted work requests. You can always activate your account again.';
                } else {
                    heading.innerText = 'Let’s get back to business!';
                    parag.innerText = 'Activate your account again to speed up your profits. You can always disable your account.';
                }
                console.error('Server status update failed:', response.status);
            }
            // If response.ok is true, the UI and server are successfully updated.
        } catch (error) {
            // Handle network errors (e.g., server offline)
            statusSwitch.checked = !newStatus; // Revert the switch
            alert('A network error occurred. Please check your connection and try again.');
            console.error('Network error during status update:', error);
        }
    });

    // Custom toggle for the left-arrow button (Existing functionality)
   // Custom toggle for the left-arrow button (Updated functionality)
    let btnn = document.getElementById("btnn");
    let sidebar = document.getElementById("first"); // Renamed divi to sidebar for clarity
    let mainContent = document.getElementById("main-content");

    btnn.onclick = function () {
        // Toggle visibility of the sidebar using Bootstrap's d-none
        let isHidden = sidebar.classList.toggle("d-none");
        
        if (isHidden) {
            // Sidebar is hidden -> make main content full width (12 columns)
            mainContent.classList.remove("col-md-9", "col-lg-10");
            mainContent.classList.add("col-md-12", "col-lg-12");
            btnn.innerHTML = ">"; // Change arrow to indicate sidebar is off-screen
        } else {
            // Sidebar is visible -> revert main content to its original width
            mainContent.classList.remove("col-md-12", "col-lg-12");
            mainContent.classList.add("col-md-9", "col-lg-10");
            btnn.innerHTML = "<"; // Change arrow to indicate sidebar is visible
        }
    };
</script>
</body>
</html>